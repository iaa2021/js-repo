 –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —Ç–≤–æ—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—à–∞–≥–æ–≤–æ –∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ üëá

–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä MongoDB –¥–ª—è Node.js, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫.

1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è
const { MongoClient } = require('mongodb');

–¢—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—à—å MongoClient –∏–∑ –ø–∞–∫–µ—Ç–∞ mongodb.
–≠—Ç–æ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É MongoDB.

2Ô∏è‚É£ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function run(){

–§—É–Ω–∫—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∞ –∫–∞–∫ async, –∑–Ω–∞—á–∏—Ç –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å await ‚Äî
—ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∫–æ–¥–æ–º –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ.

3Ô∏è‚É£ –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
const url = 'mongodb://127.0.0.1:27017/?directConnection=true';

127.0.0.1 ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É

27017 ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç MongoDB

directConnection=true ‚Äî –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–¥–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É

4Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
const client = new MongoClient(url, { ServerSelectionTimeoutMS : 500 });

–°–æ–∑–¥–∞—ë—Ç—Å—è –æ–±—ä–µ–∫—Ç –∫–ª–∏–µ–Ω—Ç–∞.

‚ö† –ó–¥–µ—Å—å –µ—Å—Ç—å –æ—à–∏–±–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:

serverSelectionTimeoutMS: 500

–° –º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã s.

–≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –æ–∑–Ω–∞—á–∞–µ—Ç:
–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –∑–∞ 500 –º—Å ‚Äî –≤—ã–¥–∞—Ç—å –æ—à–∏–±–∫—É.

5Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å (query)
let query = { address : 'Park Lane 38'};

–≠—Ç–æ —Ñ–∏–ª—å—Ç—Ä –ø–æ–∏—Å–∫–∞.

–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç –≤ MongoDB shell:

db.customers.find({ address: "Park Lane 38" })
6Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
await client.connect();
console.log('Server connected successfully.')

await –∂–¥—ë—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

7Ô∏è‚É£ –í—ã–±–æ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
const db = client.db('mydb');

–¢—ã –≤—ã–±–∏—Ä–∞–µ—à—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö mydb.

‚ö† –ï—Å–ª–∏ –µ—ë –Ω–µ—Ç ‚Äî MongoDB —Å–æ–∑–¥–∞—Å—Ç –µ—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏.

8Ô∏è‚É£ –í—ã–±–æ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏
const coll = db.collection('customers');

–≠—Ç–æ –∞–Ω–∞–ª–æ–≥ —Ç–∞–±–ª–∏—Ü—ã –≤ SQL.

9Ô∏è‚É£ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞

–í–æ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –º–æ–º–µ–Ω—Ç:

const result = await coll.find(query).toArray((err, res) => {
    if(err) throw err;
});

‚ö† –¢—ã —Å–º–µ—à–∞–ª callback –∏ async/await.

toArray():

–ª–∏–±–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å callback

–ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å await, —Ç–æ callback –Ω–µ –Ω—É–∂–µ–Ω.

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:

const result = await coll.find(query).toArray();
üîü –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
console.log(result);

–í—ã–≤–µ–¥–µ—Ç –º–∞—Å—Å–∏–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

–ü—Ä–∏–º–µ—Ä:

[
  {
    _id: ObjectId("..."),
    name: "John",
    address: "Park Lane 38"
  }
]
1Ô∏è‚É£1Ô∏è‚É£ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
catch(error){ console.error("ERROR:", err); }

‚ö† –ó–¥–µ—Å—å –æ—à–∏–±–∫–∞.

–¢—ã –ª–æ–≤–∏—à—å error, –Ω–æ –≤—ã–≤–æ–¥–∏—à—å err.

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:

catch(error){
    console.error("ERROR:", error);
}
1Ô∏è‚É£2Ô∏è‚É£ –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
finally{ 
    client.close();
    console.log("Connection closed");
}

–ë–ª–æ–∫ finally –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞.

–õ—É—á—à–µ:

await client.close();

–ü–æ—Ç–æ–º—É —á—Ç–æ close() —Ç–æ–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise.

‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
const { MongoClient } = require('mongodb');

async function run() {
    const url = 'mongodb://127.0.0.1:27017/?directConnection=true';
    const client = new MongoClient(url, { serverSelectionTimeoutMS: 500 });

    const query = { address: 'Park Lane 38' };

    try {
        await client.connect();
        console.log('Server connected successfully.');

        const db = client.db('mydb');
        console.log('Using database:', db.databaseName);

        const coll = db.collection('customers');

        const result = await coll.find(query).toArray();
        console.log(result);

    } catch (error) {
        console.error("ERROR:", error);
    } finally {
        await client.close();
        console.log("Connection closed");
    }
}

run();
üí° –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤ —Ü–µ–ª–æ–º?

–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MongoDB

–í—ã–±–∏—Ä–∞–µ—Ç –±–∞–∑—É mydb

–ò—â–µ—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ customers

–ù–∞—Ö–æ–¥–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –≥–¥–µ:

address = "Park Lane 38"

–í—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å:

üîπ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç async/await –≤–Ω—É—Ç—Ä–∏

üîπ —á–µ–º find() –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç findOne()

üîπ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç MongoDB driver –≤–Ω—É—Ç—Ä–∏ (Promise flow)

üîπ –ø–æ—á–µ–º—É –Ω–µ–ª—å–∑—è —Å–º–µ—à–∏–≤–∞—Ç—å callback –∏ await

–ß—Ç–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –≥–ª—É–±–∂–µ?